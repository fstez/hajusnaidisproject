<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Games CRUD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
    <div id="app" class="container py-4">
        <div class="d-flex justify-content-between align-items-end flex-wrap gap-2 mb-3">
            <div>
                <h1 class="h3 mb-1">Games</h1>
                <small class="text-muted">Vue 3 + Bootstrap • REST API</small>
            </div>
            <div class="d-flex gap-2">
                <input v-model.trim="filters.q" type="search" class="form-control" placeholder="Search by name" />
                <select v-model="filters.order" class="form-select w-auto">
                    <option value="asc">A→Z</option>
                    <option value="desc">Z→A</option>
                </select>
                <button class="btn btn-outline-secondary" @click="refresh" :disabled="loading">
                    <span v-if="loading" class="spinner-border spinner-border-sm me-1"></span>
                    Refresh
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createModal">Add</button>
            </div>
        </div>

        <div v-if="error" class="alert alert-danger py-2">{{ error }}</div>

        <!-- ID убран из таблицы -->
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th class="text-end" style="width:160px">Price (€)</th>
                    <th style="width:200px">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="g in visibleGames" :key="g.id">
                    <td @click="openInfo(g.id)" style="cursor:pointer">{{ g.name }}</td>
                    <td class="text-end">{{ Number(g.price).toFixed(2) }}</td>
                    <td class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-primary" @click="openEdit(g)">Edit</button>
                        <button class="btn btn-sm btn-outline-danger" @click="confirmDelete(g)">Delete</button>
                        <button class="btn btn-sm btn-outline-secondary" @click="openInfo(g.id)">Info</button>
                    </td>
                </tr>
                <tr v-if="visibleGames.length === 0">
                    <td colspan="3" class="text-center text-muted">No results</td>
                </tr>
            </tbody>
        </table>

        <!-- Create modal -->
        <div class="modal" tabindex="-1" id="createModal">
            <div class="modal-dialog">
                <form class="modal-content" @submit.prevent="createGame">
                    <div class="modal-header">
                        <h5 class="modal-title">Add game</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <label class="form-label">Name</label>
                            <input v-model.trim="formCreate.name" class="form-control" required />
                        </div>
                        <div>
                            <label class="form-label">Price</label>
                            <input v-model.number="formCreate.price" type="number" step="0.01" min="0"
                                class="form-control" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                        <button class="btn btn-primary" type="submit" :disabled="creating">
                            <span v-if="creating" class="spinner-border spinner-border-sm me-1"></span>
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit modal (ID убран из заголовка) -->
        <div class="modal" tabindex="-1" id="editModal">
            <div class="modal-dialog">
                <form class="modal-content" @submit.prevent="saveEdit">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit game</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <label class="form-label">Name</label>
                            <input v-model.trim="formEdit.name" class="form-control" required />
                        </div>
                        <div>
                            <label class="form-label">Price</label>
                            <input v-model.number="formEdit.price" type="number" step="0.01" min="0"
                                class="form-control" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                        <button class="btn btn-primary" type="submit" :disabled="saving">
                            <span v-if="saving" class="spinner-border spinner-border-sm me-1"></span>
                            Save changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Info modal (ID показывается здесь) -->
        <div class="modal" tabindex="-1" id="infoModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Game info</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <tr>
                                <th>ID</th>
                                <td>{{ gameInModal.id }}</td>
                            </tr>
                            <tr>
                                <th>Name</th>
                                <td>{{ gameInModal.name }}</td>
                            </tr>
                            <tr>
                                <th>Price</th>
                                <td>{{ gameInModal.price }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="rest-client.js"></script>
</body>

</html>